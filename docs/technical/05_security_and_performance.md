# FaiconLingo Security & Performance Optimization

This document details the strategies employed to ensure the FaiconLingo platform runs smoothly on low-end devices, minimizes data consumption, and maintains high standards for user data privacy and anti-cheat mechanisms.

---

## 1. Performance Optimization Strategies

### 1.1 Audio & Media Compression
Because audio pronunciation is the core of the app, file sizes must be strictly managed to respect the user's data plans.
*   **Audio Format:** All voice snippets from native speakers are compressed into `.opus` or highly compressed `.m4a` format. Opus provides superior quality at incredibly low bitrates (e.g., 24kbps vs traditional 128kbps MP3).
*   **Image Format:** All visual assets (Mascot animations, flashcards) use the `WebP` format, reducing visual payload by up to 30% without visible quality loss compared to PNGs.
*   **Vector Graphics:** Where possible, standard UI iconography uses vector formats (SVG, or Flutter's built-in Material/Cupertino icon fonts) rather than rasterized images.

### 1.2 Aggressive Client-Side Caching (Eviction Policies)
If a user is learning daily, the app could bloat in storage size over time.
*   **Forward Caching:** While on Wi-Fi, the app downloads the next 5 locked lesson modules.
*   **LRU (Least Recently Used) Eviction:** Once an audio file hasn't been replayed in 14 days (or it falls out of the immediate SRS queue), the local SQLite database evicts the underlying binary blob to free up space on the device.

### 1.3 Firestore Call Minimization
Firebase bills based on the number of Document Reads/Writes.
*   **Pagination:** When loading the Leaderboards, instead of querying all users, the app requests chunks of 20 users.
*   **Snapshot Listeners:** Active listener streams (which cost reads every time a document changes) are restricted *only* to the user's personal profile document. The global curriculum is a one-time "catch-up" fetch, not an active listener.

---

## 2. Security & Anti-Cheat Mechanisms

Gamification only works if the economy of XP and Status (Badges) feels earned and fair. Malicious users cannot be allowed to hack the leaderboards.

### 2.1 Firebase Security Rules
All direct client connections to Firestore are mediated through strict declarative rules.
*   **Rule Example (Profile):** A user `auth.uid` can only write to `/users/{userId}` if `auth.uid === userId`.
*   **Rule Example (Experience Points):** Rules strictly prevent a user from arbitrarily setting their XP to `9999999`. The rule mathematically limits the maximum XP increment per write call (e.g., cannot increase XP by more than `150` in a single transaction).
*   **Rule Example (ReadOnly/Admin):** Only the specific Backend Service Account (Laravel API) has write access to the `/leaderboards/` collections. Clients can strictly only read.

### 2.2 Time-Tampering Prevention
A common mobile exploit is changing the device clock to preserve a broken streak.
*   The Offline Sync Algorithm ignores the localized device timestamp and compares the last known commit against Google's secure NTP time servers provided within the Firebase Cloud Function headers.

### 2.3 API Endpoint Protection
The Laravel Backend API serves as the administrative bridge.
*   **Authentication:** All requests from the Flutter client to the Laravel endpoints are authenticated via Bearer JWTs generated by Firebase Auth.
*   **Rate Limiting:** IP-based and User ID-based rate limiting (Throttle middleware) prevents automated bot scraping of the curriculum or mass creation of fake student profiles in the FaiconLingo Academies module.

---

## 3. Data Privacy & Compliance

As an educational app handling potentially young learners, data privacy is paramount.

### 3.1 PII Minimization
*   User profiles only require a Display Name (not full legal name) and an Age Bracket to adjust onboarding paths.
*   Users logging in with Apple/Google SSO only expose the unique Oauth tokens, and email addresses are securely hashed in the backend.

### 3.2 School / Minor Protections
Within the **FaiconLingo Academies** module:
*   Student accounts generated by an Educator (via a Join Code) are "Anonymous" child accounts by default. They do not have access to public social leaderboards and cannot enter free-form text chat, complying with standards akin to COPPA (Children's Online Privacy Protection Rule) to ensure a safe learning environment.
